---
title: Golang 配置方案
date: 2018-08-13 21:22:51
tags:
  - Golang
  - 配置方案
  - 微服务
category: 码梦为生
---

最近在用 Golang 写微服务，故而研究了一下 Golang 的各种配置方案，结合自己项目中的配置选型，来谈谈 Golang 中如何进行优雅地配置。

## 前提

在开发中，我们需要面对各种各样的环境，开发环境、测试环境、生产环境等。并且，各个环境的参数和配置各不相同，比如服务器配置、数据库连接等。那么我们就需要在不同的环境下使用不同的配置。

提供配置数据的方式很多，但不外乎配置文件、环境变量以及命令行选项等。考虑到多个环境，一个良好的应用配置层次应该是这样的：
- 程序里内置配置项的初始默认值。
- 配置文件中的配置项值可以覆盖程序内配置项的默认值。
- 命令行选项和参数值具有最高优先级，可以覆盖前两层的配置项值。

## 常见的配置方案

配置文件是一种常见的配置方案，通过创建多个配置文件，如 json 文件或 yaml 文件，然后以命名区分环境，开发环境为 `development.json`，测试环境为 `test.json`，生产环境为 `production.json`。之后在系统中设置环境变量，如 `export ENV_APP=development`，让程序根据环境变量读取相应的配置文件。

这种配置方案使用起来很简单，也满足我们前面所说的良好的应用配置层次。但是在微服务的场景下，可能会遇到一些问题：

- 假如有多个服务使用了同一个配置，如数据库、消息队列等配置，并且写在了各自的配置文件中，那么当我们需要更改这些配置时，不得不逐个更新这些服务的配置，非常不灵活。

- 代码与配置放在一起，开发人员可以看到很多敏感的配置信息，比如生成环境的数据库地址、密码等，而这些敏感的配置信息应该只有少数人有权限能看到，这对系统的安全有重大影响。

- 对于大量相同的配置（比如数据库配置），逻辑上我们应该存放在同一个地方，保证只有唯一可靠的数据来源。

针对上述问题，我们很容易想到，可以将配置与程序分离，集中式管理配置。